# 1. Теория нормализации

Вспомним, из чего состоит описание реляционной базы данных:

+ Отношение
+ Схема отношения
+ Атрибуты

Теперь посмотрим, как выглядит краткая запись описания таблицы:

**Название таблицы**($\underline{\text{первичный ключ}}$, атрибут2, ...)

Она нужна для быстрой работы и ориентирования в таблицах, итоговый результат проектирования - **реальные** таблицы.

## Составляющие базы данных

1. Структура
   + Соответствие домену
2. Содержание
   + Соответствие предметной области
   + Соответствие зависимости данных

## Аномалии схемы отношения

1. Дублирование информации $\rightarrow$ для решения необходимо вынести повторяющуюся информацию в отдельные таблицы.
2. Не всю информацию можно вынести в отдельную таблицу

## Задача построения нормальных форм реляционных отношений

::: info `def` Функциональная зависимость
$r(R), \ X,Y \in R$

Есть отношение r со схемой R, X, Y - два атрибута, принадлежащие схеме.

$X \rightarrow Y$ (атрибут X функционально определяет атрибут Y), если каждому значению X соответствует единственное значение Y.
:::

Функциональные зависимости вытекают из ограничений предметной области.

### Аксиомы вывода

1. Рефлексивность X $\rightarrow$ X (атрибут функционально определяет сам себя)
2. Пополнение X $\rightarrow$ Y $\Rightarrow$ XZ $\rightarrow$ Y (совокупность атрибутов функционально определяет другой атрибут, если известно, что один из совокупности уже определяет атрибут)
3. Аддитивность X $\rightarrow$ Y, X $\rightarrow$ Z $\Rightarrow$ X $\rightarrow$ YZ
4. Проективность X $\rightarrow$ YZ $\Rightarrow$ x $\rightarrow$ y
5. Транзитивность X $\rightarrow$ Y, Y $\rightarrow$ Z $\Rightarrow$ X $\rightarrow$ Z
6. Псевдотранзитивность X $\rightarrow$ Y , YZ $\rightarrow$ W $\Rightarrow$ XZ $\rightarrow$ Y

Так можно построить полное множество функциональных зависимостей.

## Нормальные формы

### 1НФ

::: info `def` Определение
Отношение находится в **1НФ**, если все его атрибуты атомарны.
:::

### 2НФ

::: info `def` Определение
Отношение находится во **2НФ**, если оно находится в 1НФ, и в нем отсутствуют неполные функциональные зависимости от ключа.
:::

::: details Неполная зависимость от ключа

r(<u>A</u>,<u>B</u>,C,D,E)
r - отношение, A,B,C,D,E $\in$ R
PK - составной( A, B )

AB $\rightarrow$ C
AB $\rightarrow$ D
AB $\rightarrow$ E
**B $\rightarrow$ D** вытекает из предметной области

D зависит только от части ключа, эта функциональная зависимость **нарушает** условие 2НФ. Отношение r не находится во 2НФ, чтобы привести 2НФ, нужно провести декомпозицию.

**Декомпозиция** - разбиение отношения на несколько отношений


$$\rho : \begin{cases} r_1(\underline{B},\ D) \\ r_2(\underline{A}, \underline{B}, C, E) \end{cases}$$
:::

### 3НФ

::: info `def` Определение
Отношение находится в **3НФ**, если оно находится во 2НФ и в нем отсутствуют транзитивные функциональные зависимости от ключа.
:::

::: details 
r(<u>A</u>, B, C, D, E)

A $\rightarrow$ B
A $\rightarrow$ C
A $\rightarrow$ D
A $\rightarrow$ E
D $\rightarrow$ B

$$\rho : \begin{cases} r_1(\underline{D},B) \\ r_2(\underline{A},{C}, D, E) \end{cases}$$

:::

### НФБК

::: info `def` Определение
Отношение находится в **нормальной форме Бойса-Кодда**, если оно находится в 3НФ, и в нем отстутствуют функциональные зависимости ключевых атрибутов от неключевых.
:::

::: details Зависимость от неключевых атрибутов
AB $\rightarrow$ C
AB $\rightarrow$ D
AB $\rightarrow$ E
**D $\rightarrow$ B** - ключ зависит от неключевого D, нарушаем условие

$$\rho : \begin{cases} r_1(\underline{D},B) \\ r_2(\underline{A},\underline{D},C, E) \end{cases}$$
:::

## Многозначная зависимость

r(R) , X, Y, Z $\in$ R

X $\twoheadrightarrow$ (многозначно определяет) Y